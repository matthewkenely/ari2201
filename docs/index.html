<!DOCTYPE html>
<html lang="en">

<head>
    <script src="script.js"></script>
    <script src="jquery-3.6.3.js"></script>

    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="styles/styles.css">
    <link rel="stylesheet" href="styles/headerStyles.css">
    <link rel="stylesheet" href="styles/indexStyles.css">

    <title>Location Chronicles</title>
</head>

<body>
    <div id="header">
        <ul id="navbarmenu">
            <li><a href="./" class="navbaritem" id="selected">Home</a></li>
            <li><a href="news" class="navbaritem navanimate">News</a></li>
        </ul>
    </div>

    <main>
        <div id="intro">
            <img id="logo" src="images/logo.png" alt="Location Chronicles Logo">
            <h1>Location Chronicles</h1>
            <p>A project carried out by Matthew Kenely as part of his ARI2201 Individual Assigned Practical Task at the
                University of Malta.</p>
        </div>

        <h3>Article Location Detector</h3>
        <div id="drop_zone" ondrop="dropHandler(event);" ondragover="dragOverHandler(event);">
            <form action="javascript:getLocation()" id="articleinput" ondrop="console.log('drop')">
                <input id="locationinput" type="text" placeholder="https://www.example/com">
            </form>
        </div>


        <div id="result"></div>

        <div id="universities">
            <a href="https://www.um.edu.mt/ict/ai" target="_blank"><img id="umlogo" src="images/umlogo.png"
                    alt="University of Malta Logo"></a>
        </div>
    </main>
</body>

<script>
    let result = document.getElementById("result");

    function getLocation() {
        let article = document.getElementById("locationinput").value;
        var expression = /[-a-zA-Z0-9@:%._\+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b([-a-zA-Z0-9()@:%_\+.~#?&//=]*)?/gi;
        var regex = new RegExp(expression);

        if (article.match(regex)) {
            result.innerHTML = "Detecting...";
            setTimeout(function () {
                $.ajax({
                    type: "POST",
                    url: "./code/detector.py",
                }).done(function (o) {
                    console.log(o)
                });
                result.innerHTML = "Detected location of " + article + ": " + "<b>Malta</b>";
            }, 0);
        }
        else {
            result.innerHTML = "Please input a valid URL";
        }
    }

    function dropHandler(ev) {
        console.log("File(s) dropped");

        // Prevent default behavior (Prevent file from being opened)
        ev.preventDefault();

        if (ev.dataTransfer.items) {
            // Use DataTransferItemList interface to access the file(s)
            [...ev.dataTransfer.items].forEach((item, i) => {
                // If dropped items aren't files, reject them
                if (item.kind === "file") {
                    const file = item.getAsFile();
                    console.log(`… file[${i}].name = ${file.name}`);
                }
            });
        } else {
            // Use DataTransfer interface to access the file(s)
            [...ev.dataTransfer.files].forEach((file, i) => {
                console.log(`… file[${i}].name = ${file.name}`);
            });
        }
    }

    function dragOverHandler(ev) {
        console.log("File(s) in drop zone");

        // Prevent default behavior (Prevent file from being opened)
        ev.preventDefault();
    }
</script>

</html>